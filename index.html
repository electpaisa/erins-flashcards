<html>
<head>
<meta charset="utf8" />
<title>Chill babe!</title>
<style>
html { font-family:sans-serif; font-size:14px; }
#form { max-width: 940px; ; margin: 2rem auto; border: 1px solid #dbdbdb; border-radius: 5px; padding: 2rem; }
.btn, .btn:visited { color:black; padding:0.75rem 1.5rem; line-height:2.5rem; font-weight: normal; border: 1px solid; text-decoration: none; background-color: #dbdbdb; border-radius: 5px; }
.btn:hover { background-color: white; }
.btn:active { background-color: black; color:white; }
.btn:hover, .btn:active {font-weight: bold; font-size:0.92em; border:2px solid;}
.center { text-align:center; }
.right { text-align:right; }
.line {padding: 1px; margin:1rem 0; }
.capture-mode .hide-in-capture, .view-mode .hide-in-view,
.show-question #answer-display, .show-answer #question-display { display: none; }
#input-pane { resize: none; }
</style>
</head>
<body>
<form id="form" class="capture-mode">
  <div class="line right" id="swap-btns">
    <a class="btn hide-in-capture" id="capture-mode-btn" href="javascript:goToCaptureMode()">Add Card</a>
    <a class="btn hide-in-view" id="view-mode-btn" href="javascript:goToViewMode();">View cards</a>
  </div>
  <div id="capture-pane" class="hide-in-view">
    <div class="center line">
      <textarea id="input-pane" placeholder="..." rows="10" cols="80"></textarea>
    </div>
    <div class="line">
      <a class="btn" id="continue-btn" href="javascript:captureContinue()">Continue</a>
    </div>
  </div>
  <div id="view-mode" class="hide-in-capture show-question">
    <div class="line" id="question-display"></div>
    <div class="line" id="answer-display"></div>
    <div class="line">
      <a href="javascript:showAnswer()">Next</a>
    </div>
  </div>
</form>
<pre id="result-view"></pre>
<script>

function refreshState() {
  document.getElementById("result-view").innerHTML = JSON.stringify(state, null, 2);
}

function goToCaptureMode() {
  state.mode = 1;
  document.getElementById("form").className="capture-mode";
  clearCaptureInput();
}

function goToViewMode() {
  state.mode = 2;
  document.getElementById("form").className="view-mode";
  pickACard();
}

function clearCaptureInput () {
  document.getElementById("input-pane").value = "";
}

function pickACard() {
  if (state.seenCards.length === state.cards.length) {
    state.unseenCards = state.cards.slice(0);
    state.seenCards = [];
  }
  document.querySelector("#view-mode").className="hide-in-capture show-question";
  var randomCardIndex = Math.floor(Math.random() * state.unseenCards.length),
      pickedCard = state.unseenCards.splice(randomCardIndex, 1);
  console.log(pickedCard);
  state.currCard = pickedCard[0];
  state.seenCards.push(pickedCard[0]);
  document.getElementById("question-display").innerHTML = "Q: " + state.currCard.question;
  document.getElementById("answer-display").innerHTML = "A: " + state.currCard.answer;
  refreshState();
}

function showAnswer() {
  if (!state.answerVisible) {
    document.querySelector("#view-mode").className="hide-in-capture show-answer";
    state.answerVisible = true;
  } else {
    state.answerVisible = false;
    pickACard();
  }
  refreshState();
}

function captureContinue () {
  state.formState.inputs.push(document.getElementById("input-pane").value);
  clearCaptureInput();
  state.formState.phase += 1;
  if (state.formState.phase > 2) {
    var newCard = {id: state.cards.length + 1, question:state.formState.inputs[0], answer: state.formState.inputs[1] };
    state.cards.push(newCard);
    state.unseenCards.push(newCard);
    state.formState = {phase:1, inputs:[]};
    localStorage.setItem("cards", JSON.stringify(state.cards));
  }
  refreshState();
}

window.state = {
  cards: JSON.parse(localStorage.getItem("cards") || "[]"),
  seenCards: [],
  unseenCards: JSON.parse(localStorage.getItem("cards") || "[]"),
  formState: {
    phase:1,
    inputs:[],
    mode:1
  },
  currCard: {},
  answerVisible: false
};

refreshState()
</script>
</body>
</html>
